<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Les secrets de Mathilde</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- <link rel='stylesheet' type='text/css' media='screen' href='main.css'> -->
    <!-- <script src='main.js'></script> -->
</head>
<body>
    

    <style>
        /* police d'écriture AncientMedium.ttf */
        @font-face {
            font-family: 'AncientMedium';
            src: url('Betterlett.ttf') format('truetype');
        }

        *{
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body{
            background-color: #F5F5F5;
            background-image: url(parchemin.jpg);
        }
        .enigme{
            margin-top: 25vh;
            width: 100vw;
            height: 70vh;
            border-radius: 10px;
            text-align: center;
        }
        h1{
            font-family: 'AncientMedium', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2.2em;
            text-align: center;
            margin-bottom: 50px;
            padding-left: 10%;
            padding-right: 10%;
            line-height: 1.75em;
        }
        h2{
            font-family: 'AncientMedium', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 2em;
            text-align: center;
            margin-bottom: 50px;
            padding-left: 10%;
            padding-right: 10%;
            /* interligne */
            line-height: 1.75em;
        }
        .end{
            background-color: rgba(0, 0, 0, 0);
            border: 2px solid black;
            width: 100px;
            height: 50px;
        }
        .start {
            background-color: rgba(0, 0, 0, 0);
            border: none;
            font-size: 0;
            /* width: 25vw; */
            /* height: 10vh; */
            cursor: pointer;
        }

        input{
            margin: 10px;
            height: 50px;
            width: 30px;
            background-color: #3f3c2350;
            border: solid 1px black;
            text-align: center;
            border-radius: 5px;
        }

        /* shake animatio */
        @keyframes shake {
            0% { transform: translate(1px, 0px); }
            10% { transform: translate(-1px, 0px); }
            20% { transform: translate(-3px, 0px); }
            30% { transform: translate(3px, 0px); }
            40% { transform: translate(1px, 0px); }
            50% { transform: translate(-1px, 0px); }
            60% { transform: translate(-3px, 0px); }
            70% { transform: translate(3px, 0px); }
            80% { transform: translate(-1px, 0px); }
            90% { transform: translate(1px, 0px); }
            100% { transform: translate(1px, 0px); }
        }

        
        #e4 h1, #e2 h1{
            font-size: 1.25em;
        }

        .hint {
            position: absolute;
            top: 50px;
            left: 50%;
        }

        #e0 img{
            width: 30%;
        }
        .start img{
            width: 200px;
            height: auto;
        }
    </style>



    <div class="enigme" id="e0">
        <h1>
            Bienvenue à la Tour Mathilde et ses nombreux mystères.
            <br>
            À toi, cher explorateur de l'énigme et du mystère, je t'invite à plonger dans l'univers de Mathilde. Une heure t'appartient pour observer et deviner les secrets de sa vie, que tu pourras enfin pénétrer.
            <br>
            Es-tu prêt ?
        </h1>
        <button class="start"><img src="arrow.png" alt=""></button>
    </div>
    
    
    
    <div class="enigme" id="e1">
        <h1>
            Elle est née bien après, pourtant elle indique déjà l'an de son premier cri.

        </h1>
        <div class="inputs" code="1031"></div>
        <div class="soluce">
            <h2>
                Mathilde de Flandre est née vers 1031. Fille du comte Baudouin V de Flandre, elle descend de Charlemagne mais également la petite-fille du roi capétien Robert II le Pieux (996-1031).
            </h2>
        <button class="start"><img src="arrow.png" alt=""></button>
        </div>
    </div>
    
    
    <div class="enigme" id="e2">
        <h1>
            Pour le mariage de Guillaume et Mathilde, des négociations débutent probablement dès 1048 car le pape Léon IX l'interdit, sur des arguments religieux (cousins au cinquième degré) mais probablement surtout pour des raisons politiques. En 1059, le pape Nicolas II valide rétrospectivement ce mariage, sous deux conditions pour les deux époux.
            <br>
            <br>
            Une demie lieue séparent celle de Mathilde de celle de Guillaume.
        </h1>
        <div class="inputs" code="C5"></div>
        <div class="soluce">
            <h2>
                Mathilde fonde l'abbaye aux Dames de Caen, dédiée à la Sainte-Trinité à l'Est du Château. Son époux fonde l'abbaye aux Hommes, dédiée à saint Étienne, cette fois-ci à l'Ouest du Château.
            </h2>
            <button class="start"><img src="arrow.png" alt=""></button>
        </div>
    </div>
    
    
    <div class="enigme" id="e3">
        <h1>
            Du haut de leur tour, le roi et la reine contemplent leurs nombreux descendants.
        </h1>
        <div class="inputs" code="8"></div>
        <div class="soluce">
            <h2>
                Guillaume et Mathilde ont eu huit enfants dont quatre garçons et quatre filles. Un neuvième enfant reste tout de même encore questionné dans leur descendance.
            </h2>
            <button class="start"><img src="arrow.png" alt=""></button>
        </div>
    </div>

    
    <div class="enigme" id="e4">
        <h1>
            Apprenant que Harold est monté sur le trône d'Angleterre, Guillaume convoque les principaux barons normands et les convainc de se lancer à la conquête du royaume. En moins de dix mois, il rassemble une flotte d’invasion d’environ 600 navires et une armée estimée à 7 000 hommes.
            <br><br>
            Offert par Mathilde, Guillaume part conquérir l'Angleterre sur son dragon des mers.
        </h1>
        <div class="inputs" code="MORA"></div><div class="soluce">
            <h2>
                Mora est le nom traditionnellement attribué au « navire ducal » de Guillaume avec lequel il a traversé la Manche pour aller faire la conquête de l'Angleterre en 1066. Sa construction, selon une tradition, à Barfleur a été commandée par Mathilde de Flandre. Après la conquête, le navire a continué d'être utilisé par Guillaume le Conquérant pour ses allers-retours entre l'Angleterre et la Normandie.
            </h2>
            <button class="start"><img src="arrow.png" alt=""></button>
        </div>
    </div>

    <div class="enigme" id="e5">
        <h1>
            Guillaume a gagné il devient roi d'Angleterre. Et maintenant mettez vous à genoux devant la reine.
        </h1>
        <div class="inputs" code="WESTMINSTER"></div>
        <div class="soluce">
            <h2>
                Après la conquête de l'Angleterre par Guillaume Le Conquérant, Mathilde devient Reine en 1068 à Westminster. Elle apparaît, à partir de ce moment, sous le titre de "Regina" signifiant Reine.
            </h2>
            <button class="start"><img src="arrow.png" alt=""></button>
        </div>
        
    </div>

    <div class="enigme" id="e6">
        <h1>
            Cette année-là la reine s'éteint, mais la Normandie s'en souvient.
        </h1>
        <div class="inputs" code="1083"></div>
        <div class="soluce">
            <h2>
                Elle tombe malade à la fin de l'été 1083 et meurt le 2 novembre. Selon sa volonté, elle est inhumée dans l'église abbatiale de La Trinité (Abbaye aux Dames) de Caen. Sa tombe subsiste encore de nos jours, mais elle a été pillée par les protestants en 1562.
            </h2>
            <button class="start"><img src="arrow.png" alt=""></button>
        </div>
    </div>

    
    <div class="enigme" id="e7">
        <h1>
            Félécitations, vous avez réussi à percer les mystères de la vie de Mathilde.
        </h1>
        <button class="end">Fin</button>
    </div>
    
    
    <script>


        let eid = 0;
        
        let btns = document.querySelectorAll("button.start");
        for (let i = 0; i < btns.length; i++) {
            btns[i].addEventListener("click", function () {
                eid++;
                updateUI();
            });
        }


        document.querySelector("button.end").addEventListener("click", function () {
            eid = 0;
            updateUI();
        });
        
        // loop throgh div with the class inputs
        let inputs = document.querySelectorAll(".inputs");
        for (let i = 0; i < inputs.length; i++) {
            // get the code from the div
            console.log(inputs[i].getAttribute("code").length);
            let code = inputs[i].getAttribute("code");
            // create 4 inputs and append them to the div
            for (let j = 0; j < code.length; j++) {
                let input = document.createElement("input");
                input.setAttribute("type", "text");
                input.setAttribute("maxlength", "1");
                input.setAttribute("size", "1");
                input.setAttribute("id", "input" + j);
                input.setAttribute("class", "input");
                inputs[i].appendChild(input);
                // when the input is filled, focus on the next one and override the value
                input.addEventListener("keyup", function(){
                    if (this.value.length == this.maxLength) {
                        let next = this.nextElementSibling;
                        if (next != null) {
                            next.focus();
                        } else {
                            this.blur();
                            checkcode();
                        }
                        this.value = this.value.toUpperCase();
                    }
                });
            }
        }


        function wrongAnim(){
            let inputs = document.querySelectorAll("input");
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].style.backgroundColor = "#a81a1a";
                inputs[i].style.animation = "shake 1s";
                
                setTimeout(function () {
                    inputs[i].style.animation = "";
                }, 1000);

                setTimeout(function(){
                    inputs[i].style.backgroundColor = "#3f3c2350";
                }, 500);
            }


        }

        updateUI();

        function checkcode() {
            // get the code from the div with the id e1
            let code = document.getElementById("e" + eid).querySelector(".inputs").getAttribute("code");
            // get the inputs from the div with the id e1
            let inputs = document.getElementById("e" + eid).querySelectorAll(".input");
            // create a variable to store the value of the inputs
            let value = "";
            // loop through the inputs
            for (let i = 0; i < inputs.length; i++) {
                // add the value of the input to the variable
                value += inputs[i].value;
            }
            value = value.toUpperCase();
            // check if the value is the same as the code
            console.log(code + " " + value);
            if (code == value) {
                // TODO: Afficher le texte d'exposition et le bouton suivant
                // hide all h1


                let enigmes = document.querySelectorAll(".enigme h1");
                for (let i = 0; i < enigmes.length; i++) {
                    enigmes[i].style.display = "none";
                }

                for (let i = 0; i < inputs.length; i++) {
                    inputs[i].style.display = "none";
                }
                
                // let txtsoluce = document.querySelectorAll(".soluce")
                // for (let i = 0; i < txtsoluce.length; i++) {
                //     txtsoluce[i].style.display = "block";
                // }
                let opa = 0;
                let soluce = document.getElementById("e" + eid).querySelector(".soluce");
                soluce.style.opacity = opa;
                soluce.style.display = "block";
                let timer = setInterval(function () {
                    if (opa >= 1) {
                        clearInterval(timer);
                    }
                    opa += 0.05;
                    soluce.style.opacity = opa;
                }, 100);



            } else {
                wrongAnim();
                for (let i = 0; i < inputs.length; i++) {
                    inputs[i].value = "";
                }
                // refocus on the first input
                inputs[0].focus();
            }
        }


        function updateUI() {
            let soluces = document.querySelectorAll(".soluce");
            for (let i = 0; i < soluces.length; i++) {
                soluces[i].style.display = "none";
            }

            let enigmestxt = document.querySelectorAll(".enigme h1");
            for (let i = 0; i < enigmestxt.length; i++) {
                enigmestxt[i].style.display = "block";
            }
            let inputs = document.querySelectorAll(".input");
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].style.display = "inline-block";
            }
            // loop through all the divs with the class enigme
            // clear all inputs
            // let inputs = document.querySelectorAll(".input");
            for (let i = 0; i < inputs.length; i++) {
                inputs[i].value = "";
            }
            let enigmes = document.querySelectorAll(".enigme");
            for (let i = 0; i < enigmes.length; i++) {
                // hide all the divs
                enigmes[i].style.display = "none";
            }
            // show the div with the id e1
            document.getElementById("e" + eid).style.display = "block";

            // make a transition with the text 
            let text = document.getElementById("e" + eid).querySelector("h1");
            text.style.opacity = "0";
            for (let i = 0; i < 20; i++) {
                setTimeout(function () {
                    text.style.opacity = i / 20;
                }, i * 100);
            }
            



            // focus on the first input
            document.getElementById("e" + eid).querySelector(".input").focus();
        }



    </script>




</body>
</html>